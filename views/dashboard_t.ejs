<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="../styles/dashboard_t.css" />
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->

    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>

 

</head>

<body>
    <div class="outer">
        <div class="col1">
            <img src="../images/logo.jpeg" id="logo" />
            <div class="menu_items">
                <h1>MENU</h1>
                <div id="home" onclick="menu_click()" class="active">
                    <ion-icon name="home-outline"></ion-icon> &nbsp
                    Home
                </div>
                <div id="attendance" onclick="menu_click()">
                    <ion-icon name="checkbox-outline"></ion-icon> &nbsp
                    Attendance
                </div>
                <div id="notes" onclick="menu_click()">
                    <ion-icon name="reorder-four-outline"></ion-icon> &nbsp
                    Notes
                </div>
                <div id="grades" onclick="menu_click()">
                    <ion-icon name="school-outline"></ion-icon> &nbsp
                    Grades
                </div>
                <div id="settings" onclick="menu_click()">
                    <ion-icon name="settings-outline"></ion-icon> &nbsp
                    Settings
                </div>
            </div>
        </div>
        <div class="col2">
            <div class="col2-header">
                <h1 id="welcome">Hello</h1>
                <h2>Welcome Back</h2>
            </div>
            <br /><br /><br />
            <div id="home_content">
                <div class="lec_taken">
                  <h2>Lectures Taken</h2>
                  <p>45</p>
                </div>
                <div class="total_lec">
                  <h2>Total Lectures</h2>
                  <p><%= data_t2["Lecture_count"] %></p>
                </div>
              </div>
            <div id="attendance_content">
                <form action="/attendance" method="post">
                    <table id="attendance_table">
                        <tr>
                            <th>Name of student</th>
                            <th>Tick if present</th>
                        </tr>
                        <% for(let data in data_s2) {%>
                            <tr>
                                <td><%=data_s2[data].First_name%> <%=data_s2[data].Last_name%>
                                </td>
                                <td>
                                    <input type="checkbox" id="<%=data_s2[data]._id%>" name="attended" value="<%=data_s2[data]._id%>">
                                </td>
                                <td class="s_id"><input name="id" value="<%=data_s2[data]._id%>"></td>
                            </tr>
                        <% } %>
                    </table>
                    <br>
                    <button type="submit">Save Data</button>
                </form>
            </div>
            <div id="notes_content">
                <div>
                    <h2 style="text-align:center ;">Notes</h2>
                    <div>
                        <h3 style="display:inline ;">Upload material</h3>
                        <button id="upload_widget" class="cloudinary-button">Upload files</button>
                       
                        <table id="material_table">
                            <tr>
                                <th>Filename</th>
                                <th>Link</th>
                            </tr>
                            <% for(let i in material) {%>
                                <tr>
                                    <td >
                                        <%=material[i].File_name%>
                                    </td>
                                      <td><a href="<%=material[i].URL%>" target="_blank">Open File</a> </td>
                                </tr>
                                <% } %>
                        </table><a></a>
                    </div>
                </div>
            </div>
            <div id="grades_content">
                <h2>Enter Student Marks</h2>
                <form action="/grades" method="post">
                    <table>
                        <tr>
                            <th>Name of Student</th>
                            <th>Marks</th>
                        </tr>
                        <% for(let data in data_s2) {%>
                            <tr>
                                <td name="name" value="<%=data_s2[data]._id%>">
                                    <%=data_s2[data].First_name%> <%=data_s2[data].Last_name%>
                                </td>
                                <td><input type="number" min="0" max="100" name="marks" placeholder="Enter Marks"></td>
                                <td class="s_id"><input min="0" max="100" name="id"  value="<%=data_s2[data]._id%>" ></td>
                            </tr>
                            <% } %>
                    </table>
                    <br>
                    <button type="submit" class="submit">Submit Marks</button>
                </form>
            </div>
            <div id="settings_content">In settings</div>
        </div>
        <div class="col3">
            <div>
                <div style="width: 100%">
                    <form action="/logout" method="post">
                        <button id="teacher_logout" type="submit">logout</button>
                    </form>
                </div>
                <br /><br />
                <form action="/teacher_pic" method="post" enctype="multipart/form-data">
                    <div id="dp">
                        <img src="" alt="abc" id="profilepic" />
                        <div id="blackfill">
                            <input type="file" id="filechooser" accept=".jpg,.jpeg,.png" name="img" value="<%=data_t["Img_url"]%>"/>
                        </div>
                    </div>
                    <button type="submit" id="upload_pic">Upload</button>
                </form>
                    <br /><br />
                    <h2><%=data_t2["First_name"]%> <%=data_t2["Last_name"]%></h2>
                    <h3>BE-III CSE</h3>
                    <br /><br />
                    <h2>Notifications</h2>
                    <br /><br /><br />
                    <h2>Messages</h2>
            </div>
        </div>
    </div>
    <p id="teacher_data" style="display: none;">
        <%= data_t %>
    </p>
    <p id="student_data" style="display: none;">
        <%= data_s %>
    </p>
    <script src="../js/dashboard_t.js"></script>
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>

    <script type="text/javascript">
       
        const material_table = document.getElementById("material_table");
        var myWidget = cloudinary.createUploadWidget({
            cloudName: 'dedseoasc',
            uploadPreset: 'abyxzsh3'
        }, (error, result) => {
            if (!error && result && result.event === "success") {
                console.log('Done! Here is the image info: ', result.info);
                console.log(result.info.secure_url)
                
                sendData(result.info.secure_url,result.info.original_filename)
                alert("Data uploaded succesfully")



            }
        }
        )

        document.getElementById("upload_widget").addEventListener("click", function () {
            myWidget.open();
        }, false);
        function sendData(link,filename){
    
    let data = {
        URL: link,
        File_name:filename
    }
    let options = {
        method: 'POST',
        headers: {
            "Content-type": "application/json; charset=UTF-8"
        },
        body: JSON.stringify(data)
    }
    const promise = fetch('/material', options);
    promise.then(response => {
        if(!response.ok){
            console.error(response)
        } else {
            return response.json();
        }
    }).then(result => {
        console.log(result);
    })
}
    </script>
</body>

</html>